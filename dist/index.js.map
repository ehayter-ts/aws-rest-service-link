{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import '@k2oss/k2-broker-core';\n\nmetadata = {\n    systemName: \"AWS_API\",\n    displayName: \"AWS API Broker\",\n    description: \"AWS API Broker\"\n};\n\nondescribe = async function({configuration}): Promise<void> {\n    postSchema({\n        objects: {\n            \"pet\": {\n                displayName: \"Pet\",\n                description: \"Manages a pets list\",\n                properties: {\n                    \"id\": {\n                        displayName: \"ID\",\n                        type: \"number\"\n                    },\n                    \"type\": {\n                        displayName: \"Type\",\n                        type: \"string\"\n                    },\n                    \"price\": {\n                        displayName: \"Price\",\n                        type: \"decimal\"\n                    }\n                },\n                methods: {\n                    \"get\": {\n                        displayName: \"Get Pets\",\n                        type: \"list\",\n                        inputs: [],\n                        outputs: [ \"id\", \"type\", \"price\" ]\n                    }\n                }\n            }\n        }\n    });\n}\n\nonexecute = async function({objectName, methodName, parameters, properties, configuration, schema}): Promise<void> {\n    switch (objectName)\n    {\n        case \"pet\": await onexecuteTodo(methodName, properties, parameters); break;\n        default: throw new Error(\"The object \" + objectName + \" is not supported.\");\n    }\n}\n\nasync function onexecuteTodo(methodName: string, properties: SingleRecord, parameters: SingleRecord): Promise<void> {\n    switch (methodName)\n    {\n        case \"get\": await onexecuteTodoGet(properties); break;\n        default: throw new Error(\"The method \" + methodName + \" is not supported.\");\n    }\n}\n\nfunction onexecuteTodoGet(properties: SingleRecord): Promise<void> {\n    return new Promise<void>((resolve, reject) =>\n    {\n        var xhr = new XMLHttpRequest();\n        xhr.onreadystatechange = function() {\n            try {\n                if (xhr.readyState !== 4) return;\n                if (xhr.status !== 200) throw new Error(\"Failed with status \" + xhr.status);\n\n                var arrayObj = JSON.parse(xhr.responseText);\n                postResult(arrayObj.map(x => {\n                    return {\n                        \"id\": x.id,\n                        \"type\": x.type,\n                        \"price\": x.price\n                    }\n                }));\n                resolve();\n            } catch (e) {\n                reject(e);\n            }\n        };\n        \n        if(typeof properties[\"id\"] !== \"number\") throw new Error(\"properties[\\\"id\\\"] is not of type number\");\n        xhr.open(\"GET\", 'http://petstore.execute-api.eu-west-2.amazonaws.com/petstore/pets');\n        xhr.setRequestHeader('test', 'test value');\n        xhr.send();\n    });\n}"],"names":["metadata","systemName","displayName","description","ondescribe","async","configuration","postSchema","objects","properties","type","methods","inputs","outputs","onexecute","objectName","methodName","parameters","schema","Promise","resolve","reject","xhr","XMLHttpRequest","onreadystatechange","readyState","status","Error","arrayObj","JSON","parse","responseText","postResult","map","x","id","price","e","open","setRequestHeader","send","onexecuteTodoGet","onexecuteTodo"],"mappings":"AAEAA,SAAW,CACPC,WAAY,UACZC,YAAa,iBACbC,YAAa,kBAGjBC,WAAaC,gBAAeC,cAACA,IACzBC,WAAW,CACPC,QAAS,KACE,CACHN,YAAa,MACbC,YAAa,sBACbM,WAAY,IACF,CACFP,YAAa,KACbQ,KAAM,eAEF,CACJR,YAAa,OACbQ,KAAM,gBAED,CACLR,YAAa,QACbQ,KAAM,YAGdC,QAAS,KACE,CACHT,YAAa,WACbQ,KAAM,OACNE,OAAQ,GACRC,QAAS,CAAE,KAAM,OAAQ,gBAQjDC,UAAYT,gBAAeU,WAACA,EAADC,WAAaA,EAAbC,WAAyBA,EAAzBR,WAAqCA,EAArCH,cAAiDA,EAAjDY,OAAgEA,WAC/EH,OAEC,YAKbV,eAA6BW,EAAoBP,EAA0BQ,UAC/DD,OAEC,YAKb,SAA0BP,UACf,IAAIU,QAAc,CAACC,EAASC,SAE3BC,EAAM,IAAIC,kBACdD,EAAIE,mBAAqB,kBAEM,IAAnBF,EAAIG,WAAkB,UACP,MAAfH,EAAII,OAAgB,MAAM,IAAIC,MAAM,sBAAwBL,EAAII,YAEhEE,EAAWC,KAAKC,MAAMR,EAAIS,cAC9BC,WAAWJ,EAASK,IAAIC,IACb,IACGA,EAAEC,QACAD,EAAExB,WACDwB,EAAEE,UAGnBhB,IACF,MAAOiB,GACLhB,EAAOgB,KAIgB,iBAArB5B,EAAU,GAAqB,MAAM,IAAIkB,MAAM,0CACzDL,EAAIgB,KAAK,MAAO,qEAChBhB,EAAIiB,iBAAiB,OAAQ,cAC7BjB,EAAIkB,SA/BcC,CAAiBhC,uBACpB,IAAIkB,MAAM,cAAgBX,EAAa,uBATpC0B,CAAc1B,EAAYP,uBAC7B,IAAIkB,MAAM,cAAgBZ,EAAa"}